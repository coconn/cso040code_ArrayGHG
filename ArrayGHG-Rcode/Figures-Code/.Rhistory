# APPROACH 2: MONTE CARLO SIMULATION
# normal for CH4
# log-normal, chi-squared or gamma for CO2 (can't go negative with any of these 3)
# wait, but it's not that the multiplier can't go negative, it's that CO2 flux shouldn't be negative... so need to figure that out
# ended up going with a truncated normal distribution for CO2
# applies to both CO2 and CH4
lengthperiod <- c(61,121,92,52)
simulationreps <- 5000
# topolocation proportion
ridgeprop	<- 0.17
slopeprop <-	0.65
valleyprop <-	0.18
########################################################################
# CO2-e CO2 SIMULATION
## CO2e CO2 calcs
# meanCO2_umolm2s
CO2meanR <- c(1.829500922,1.508863804,1.88162955,2.772106974)
CO2meanS <- c(3.793756534,6.058448581,5.13065924,4.515184411)
CO2meanV <- c(0.572222123,1.506285204,1.360654498,2.946791535)
# sdCO2_umolm2s
CO2sdR <- c(1.467956332,1.046804732,1.636949891,2.420277315)
CO2sdS <- c(2.921048514,4.255562169,4.339260199,2.797889389)
CO2sdV <- c(0.172000807,0.752823235,0.473832261,1.025457778)
# topo wgt avg, CO2_umolm2s
CO2meanRSV <- (CO2meanR*ridgeprop)+(CO2meanS*slopeprop)+(CO2meanV*valleyprop)
CO2sdRSV <- (CO2sdR*ridgeprop)+(CO2sdS*slopeprop)+(CO2sdV*valleyprop)
# CO2_kg_per_ha_per_d
CO2e_CO2_daymeanRSV <- CO2meanRSV * 12.01 * 10000 * 86400 / 1000000000
CO2e_CO2_daysdRSV <- CO2sdRSV * 12.01 * 10000 * 86400 / 1000000000
# create a matrix of many cumulative sum steps
# observed drought periods
M1 <- replicate(simulationreps, rtruncnorm(n=lengthperiod[1], a=0, b=Inf, mean=CO2e_CO2_daymeanRSV[1], sd=CO2e_CO2_daysdRSV[1]))
M2 <- replicate(simulationreps, rtruncnorm(n=lengthperiod[2], a=0, b=Inf, mean=CO2e_CO2_daymeanRSV[2], sd=CO2e_CO2_daysdRSV[2]))
M3 <- replicate(simulationreps, rtruncnorm(n=lengthperiod[3], a=0, b=Inf, mean=CO2e_CO2_daymeanRSV[3], sd=CO2e_CO2_daysdRSV[3]))
M4 <- replicate(simulationreps, rtruncnorm(n=lengthperiod[4], a=0, b=Inf, mean=CO2e_CO2_daymeanRSV[4], sd=CO2e_CO2_daysdRSV[4]))
# baseline
M1_base <- replicate(simulationreps, rtruncnorm(n=sum(lengthperiod), a=0, b=Inf, mean=CO2e_CO2_daymeanRSV[1], sd=CO2e_CO2_daysdRSV[1]))
Mnotcs <- rbind(M1, M2, M3, M4)
M <- apply(Mnotcs, 2, cumsum)
M_base <- apply(M1_base, 2, cumsum)
# get the summary stats from that simulation
# observed
summaryMmean <- rowMeans(M)
summaryMsd <- apply(M,1,sd)
summaryM975 <- apply(M,1,quantile,probs=c(.975))
summaryM25 <- apply(M,1,quantile,probs=c(.025))
summaryM <- data.frame(summaryMmean=summaryMmean, summaryMsd=summaryMsd, summaryM975=summaryM975, summaryM25=summaryM25, day=c(1:sum(lengthperiod)))
# baseline
summaryMmean_base <- rowMeans(M_base)
summaryMsd_base <- apply(M_base,1,sd)
summaryM975_base <- apply(M_base,1,quantile,probs=c(.975))
summaryM25_base <- apply(M_base,1,quantile,probs=c(.025))
summaryM_base <- data.frame(summaryMmean_base=summaryMmean_base, summaryMsd_base=summaryMsd_base, summaryM975_base=summaryM975_base, summaryM25_base=summaryM25_base, day=c(1:sum(lengthperiod)))
# plot the summary stats, observed
pM1 <- ggplot(summaryM, aes(day)) + geom_line(aes(y = summaryMmean, colour = "summaryMmean"), size=1, color="black") + geom_errorbar(aes(ymin=summaryM25,ymax=summaryM975), alpha=0.3, color="black", width = 0) + theme_bw()
# plot the summary stats, baseline
pM2 <- ggplot(summaryM_base, aes(day)) + geom_line(aes(y = summaryMmean_base, colour = "summaryMmean"), size=1, color="black") + geom_errorbar(aes(ymin=summaryM25_base,ymax=summaryM975_base), alpha=0.3, color="black", width = 0) + theme_bw()
# plot the observed and baseline
pM3 <- ggplot(summaryM, aes(day)) + geom_line(aes(y = summaryMmean, colour = "summaryMmean"), size=1, color="black") + geom_errorbar(aes(ymin=summaryM25,ymax=summaryM975), alpha=0.3, color="black", width = 0) + theme_bw() + geom_line(data = summaryM_base, aes(y = summaryMmean_base, colour = "summaryMmean_base"), size=1, color="blue") + geom_errorbar(data = summaryM_base, aes(ymin=summaryM25_base,ymax=summaryM975_base), alpha=0.3, color="blue", width = 0)
########################################################################
# CO2-e CH4 SIMULATION
# now do the same with CH4
# meanCH4_umolm2s
CH4meanR <- c(-0.63629477,-1.120537043,-0.666803886,10.1226501)
CH4meanS <- c(0.148996378,-1.933354222,-0.605964719,15.15579608)
CH4meanV <- c(17.42923214,1.677103246,1.503544041,19.2124457)
# sdCH4_umolm2s
CH4sdR <- c(0.758049582,1.002026476,0.660281571,7.842487625	)
CH4sdS <- c(0.690664063,1.725763755,0.969675935,7.025239716)
CH4sdV <- c(29.60551411,4.088934826,2.58395312,8.36574107)
# topo wgt avg, CH4_umolm2s
CH4meanRSV <- (CH4meanR*ridgeprop)+(CH4meanS*slopeprop)+(CH4meanV*valleyprop)
CH4sdRSV <- (CH4sdR*ridgeprop)+(CH4sdS*slopeprop)+(CH4sdV*valleyprop)
# CH4_kg_per_ha_per_d
CO2e_CH4_daymeanRSV <- CH4meanRSV * 12.01 * 10000 * 86400 / 1000000000 * 34
CO2e_CH4_daysdRSV <- CH4sdRSV * 12.01 * 10000 * 86400 / 1000000000 * 34
# create a matrix of many cumulative sum steps
lengthperiod <- c(61,121,92,52)
simulationreps <- 10
# observed drought periods
D1 <- replicate(simulationreps, rnorm(n=lengthperiod[1], mean=CO2e_CH4_daymeanRSV[1], sd=CO2e_CH4_daysdRSV[1]))
D2 <- replicate(simulationreps, rnorm(n=lengthperiod[2], mean=CO2e_CH4_daymeanRSV[2], sd=CO2e_CH4_daysdRSV[2]))
D3 <- replicate(simulationreps, rnorm(n=lengthperiod[3], mean=CO2e_CH4_daymeanRSV[3], sd=CO2e_CH4_daysdRSV[3]))
D4 <- replicate(simulationreps, rnorm(n=lengthperiod[4], mean=CO2e_CH4_daymeanRSV[4], sd=CO2e_CH4_daysdRSV[4]))
# baseline
D1_base <- replicate(simulationreps, rnorm(n=sum(lengthperiod), mean=CO2e_CH4_daymeanRSV[1], sd=CO2e_CH4_daysdRSV[1]))
Dnotcs <- rbind(D1, D2, D3, D4)
D <- apply(Dnotcs, 2, cumsum)
D_base <- apply(D1_base, 2, cumsum)
# get the summary stats from that simulation
# observed
summaryDmean <- rowMeans(D)
summaryDsd <- apply(D,1,sd)
summaryD975 <- apply(D,1,quantile,probs=c(.975))
summaryD25 <- apply(D,1,quantile,probs=c(.025))
summaryD <- data.frame(summaryDmean=summaryDmean, summaryDsd=summaryDsd, summaryD975=summaryD975, summaryD25=summaryD25, day=c(1:sum(lengthperiod)))
# baseline
summaryDmean_base <- rowMeans(D_base)
summaryDsd_base <- apply(D_base,1,sd)
summaryD975_base <- apply(D_base,1,quantile,probs=c(.975))
summaryD25_base <- apply(D_base,1,quantile,probs=c(.025))
summaryD_base <- data.frame(summaryDmean_base=summaryDmean_base, summaryDsd_base=summaryDsd_base, summaryD975_base=summaryD975_base, summaryD25_base=summaryD25_base, day=c(1:sum(lengthperiod)))
# plot the summary stats, observed
pD1 <- ggplot(summaryD, aes(day)) + geom_line(aes(y = summaryDmean, colour = "summaryDmean"), size=1, color="black") + geom_errorbar(aes(ymin=summaryD25,ymax=summaryD975), alpha=0.3, color="black", width = 0) + theme_bw()
# plot the summary stats, baseline
pD2 <- ggplot(summaryD_base, aes(day)) + geom_line(aes(y = summaryDmean_base, colour = "summaryDmean"), size=1, color="black") + geom_errorbar(aes(ymin=summaryD25_base,ymax=summaryD975_base), alpha=0.3, color="black", width = 0) + theme_bw()
# plot the observed and baseline
pD3 <- ggplot(summaryD, aes(day)) + geom_line(aes(y = summaryDmean, colour = "summaryDmean"), size=1, color="black") + geom_errorbar(aes(ymin=summaryD25,ymax=summaryD975), alpha=0.3, color="black", width = 0) + theme_bw() + geom_line(data = summaryD_base, aes(y = summaryDmean_base, colour = "summaryDmean_base"), size=1, color="blue") + geom_errorbar(data = summaryD_base, aes(ymin=summaryD25_base,ymax=summaryD975_base), alpha=0.3, color="blue", width = 0)
########################################################################
# SAVE FIGURE OF COMBINED RESULTS
# now get a full combined figure
pMD3 <- ggplot(summaryD, aes(day)) + geom_line(aes(y = summaryDmean, colour = "summaryDmean"), size=1, color="black") + geom_errorbar(aes(ymin=summaryD25,ymax=summaryD975), alpha=0.3, color="black", width = 0) + theme_bw() + geom_line(data = summaryD_base, aes(y = summaryDmean_base, colour = "summaryDmean_base"), size=1, color="blue") + geom_errorbar(data = summaryD_base, aes(ymin=summaryD25_base,ymax=summaryD975_base), alpha=0.3, color="blue", width = 0) + geom_line(data = summaryM, aes(y = summaryMmean, colour = "summaryMmean"), size=1, color="black") + geom_errorbar(data = summaryM, aes(ymin=summaryM25,ymax=summaryM975), alpha=0.3, color="black", width = 0) + geom_line(data = summaryM_base, aes(y = summaryMmean_base, colour = "summaryMmean_base"), size=1, color="blue") + geom_errorbar(data = summaryM_base, aes(ymin=summaryM25_base,ymax=summaryM975_base), alpha=0.3, color="blue", width = 0)
# save combined panels
png(file = paste(pathsavefigs, "CO2e_cumulative.png", sep=""),width=8,height=12,units="in",res=400)
grid.arrange(pM3, pD3, nrow = 2, ncol = 1)
dev.off()
########################################################################
# APPROACH 1: PROPAGATE THE SD ACROSS THE TIME PERIOD
# this failed massively, so everything below is now commented out
# this is based off of the excel spreadsheet work that I did by hand at the outset for this analysis
#
# ########################################################################
# # BRING IN GHG DATA, MAKE DATAFRAME
#
# # load csv
# arrayCO2edf <- read.csv(paste(pathGHGdata, "ghg-co2e-analysis-csv.csv", sep = ""), stringsAsFactors=FALSE)
#
# # for reference, these are the variables in order
# # day
# # drought period
# # CO2-e CO2 cumulative kg per ha - actual
# # CO2-e CH4 cumulative kg per ha - actual
# # CO2-e total cumulative kg per ha - actual
# # CO2-e CO2 cumulative kg per ha - baseline
# # CO2-e CH4 cumulative kg per ha - baseline
# # CO2-e total cumulative kg per ha - baseline
# # CO2-e CO2 cumulative kg per ha - actual, high
# # CO2-e CH4 cumulative kg per ha - actual, high
# # CO2-e total cumulative kg per ha - actual, high
# # CO2-e CO2 cumulative kg per ha - baseline, high
# # CO2-e CH4 cumulative kg per ha - baseline, high
# # CO2-e total cumulative kg per ha - baseline, high
# # CO2-e CO2 cumulative kg per ha - actual, low
# # CO2-e CH4 cumulative kg per ha - actual, low
# # CO2-e total cumulative kg per ha - actual, low
# # CO2-e CO2 cumulative kg per ha - baseline, low
# # CO2-e CH4 cumulative kg per ha - baseline, low
# # CO2-e total cumulative kg per ha - baseline, low
#
# # nice names
# newnames <- c("day","DroughtPeriod","CO2eCO2_obs_mean","CO2eCH4_obs_mean","CO2eTOT_obs_mean","CO2eCO2_base_mean","CO2eCH4_base_mean","CO2eTOT_base_mean","CO2eCO2_obs_hi","CO2eCH4_obs_hi","CO2eTOT_obs_hi","CO2eCO2_base_hi","CO2eCH4_base_hi","CO2eTOT_base_hi","CO2eCO2_obs_lo","CO2eCH4_obs_lo","CO2eTOT_obs_lo","CO2eCO2_base_lo","CO2eCH4_base_lo","CO2eTOT_base_lo")
# names(arrayCO2edf) <- newnames
#
# # make factors where needed
# arrayCO2edf$DroughtPeriod <- as.factor(arrayCO2edf$DroughtPeriod)
# # str(arrayCO2edf)
#
#
# ########################################################################
# # CO2 CO2e TIME SERIES
#
# pCO2 <- ggplot(arrayCO2edf, aes(day)) + geom_line(aes(y = CO2eCO2_obs_mean, colour = "CO2eCO2_obs_mean"), size=1) + geom_line(aes(y = CO2eCO2_base_mean, colour = "CO2eCO2_base_mean"), size=1) + geom_errorbar(aes(ymin=CO2eCO2_obs_lo,ymax=CO2eCO2_obs_hi), alpha=0.1, color="blue", width = 0) + geom_errorbar(aes(ymin=CO2eCO2_base_lo,ymax=CO2eCO2_base_hi), alpha=0.1, color="black", width = 0) + theme_bw() + scale_color_manual("",values=c(CO2eCO2_obs_mean="blue",CO2eCO2_base_mean="black"), labels=c("Baseline", "Observed")) + ylab("Cumulative CO2-e, CO2 (kg/ha)") + xlab("Day")
#
# pCH4 <- ggplot(arrayCO2edf, aes(day)) + geom_line(aes(y = CO2eCH4_obs_mean, colour = "CO2eCH4_obs_mean"), size=1) + geom_line(aes(y = CO2eCH4_base_mean, colour = "CO2eCH4_base_mean"), size=1) + geom_errorbar(aes(ymin=CO2eCH4_obs_lo,ymax=CO2eCH4_obs_hi), alpha=0.1, color="blue", width = 0) + geom_errorbar(aes(ymin=CO2eCH4_base_lo,ymax=CO2eCH4_base_hi), alpha=0.1, color="black", width = 0) + theme_bw() + scale_color_manual("",values=c(CO2eCH4_obs_mean="blue",CO2eCH4_base_mean="black"), labels=c("Baseline", "Observed")) + ylab("Cumulative CO2-e, CH4 (kg/ha)") + xlab("Day")
#
# pTOT <- ggplot(arrayCO2edf, aes(day)) + geom_line(aes(y = CO2eTOT_obs_mean, colour = "CO2eTOT_obs_mean"), size=1) + geom_line(aes(y = CO2eTOT_base_mean, colour = "CO2eTOT_base_mean"), size=1) + geom_errorbar(aes(ymin=CO2eTOT_obs_lo,ymax=CO2eTOT_obs_hi), alpha=0.1, color="blue", width = 0) + geom_errorbar(aes(ymin=CO2eTOT_base_lo,ymax=CO2eTOT_base_hi), alpha=0.1, color="black", width = 0) + theme_bw() + scale_color_manual("",values=c(CO2eTOT_obs_mean="blue",CO2eTOT_base_mean="black"), labels=c("Baseline", "Observed")) + ylab("Cumulative CO2-e, CO2+CH4 (kg/ha)") + xlab("Day")
#
# pCombo <- ggplot(arrayCO2edf, aes(day)) + geom_line(aes(y = CO2eTOT_obs_mean, colour = "CO2eTOT_obs_mean"), size=1) + geom_line(aes(y = CO2eTOT_base_mean, colour = "CO2eTOT_base_mean"), size=1) + geom_line(aes(y = CO2eCO2_obs_mean, colour = "CO2eCO2_obs_mean"), size=1) + geom_line(aes(y = CO2eCO2_base_mean, colour = "CO2eCO2_base_mean"), size=1) + geom_line(aes(y = CO2eCH4_obs_mean, colour = "CO2eCH4_obs_mean"), size=1) + geom_line(aes(y = CO2eCH4_base_mean, colour = "CO2eCH4_base_mean"), size=1) + theme_bw() #+ geom_errorbar(aes(ymin=CO2eTOT_obs_lo,ymax=CO2eTOT_obs_hi), alpha=0.1, width = 0) + geom_errorbar(aes(ymin=CO2eTOT_base_lo,ymax=CO2eTOT_base_hi), alpha=0.1, width = 0) + geom_errorbar(aes(ymin=CO2eCH4_obs_lo,ymax=CO2eCH4_obs_hi), alpha=0.1, width = 0) + geom_errorbar(aes(ymin=CO2eCH4_base_lo,ymax=CO2eCH4_base_hi), alpha=0.1, width = 0) + geom_errorbar(aes(ymin=CO2eCO2_obs_lo,ymax=CO2eCO2_obs_hi), alpha=0.1, width = 0) + geom_errorbar(aes(ymin=CO2eCO2_base_lo,ymax=CO2eCO2_base_hi), alpha=0.1, width = 0) + ylab("Cumulative CO2-e, CO2+CH4 (kg/ha)") + xlab("Day") #+ scale_color_manual("",values=c(CO2eTOT_obs_mean="blue",CO2eTOT_base_mean="black"), labels=c("Baseline", "Observed"))
#
#
# # save combined figure
#
# # only the gas panels
# #png(file = paste(pathsavefigs, "CO2e_cumulative.png", sep=""),width=8,height=12,units="in",res=400)
# grid.arrange(pCO2, pCH4, pCombo, nrow = 3, ncol = 1)
# #dev.off()
#
pM3
pD3
?grid.arrange
png(file = paste(pathsavefigs, "CO2e_cumulative.png", sep=""),width=3,height=6,units="in",res=400)
grid.arrange(pM3, pD3, nrow = 2, ncol = 1)
dev.off()
png(file = paste(pathsavefigs, "CO2e_cumulative.png", sep=""),width=5,height=6,units="in",res=400)
grid.arrange(pM3, pD3, nrow = 2, ncol = 1)
dev.off()
ggplot(summaryM, aes(day)) + geom_line(aes(y = summaryMmean, colour = "summaryMmean"), size=1, color="black") + geom_errorbar(aes(ymin=summaryM25,ymax=summaryM975), alpha=0.3, color="black", width = 0) + theme_bw() + geom_line(data = summaryM_base, aes(y = summaryMmean_base, colour = "summaryMmean_base"), size=1, color="blue") + geom_errorbar(data = summaryM_base, aes(ymin=summaryM25_base,ymax=summaryM975_base), alpha=0.3, color="blue", width = 0) + theme(axis.title.x=element_blank())
ggplot(summaryD, aes(day)) + geom_line(aes(y = summaryDmean, colour = "summaryDmean"), size=1, color="black") + geom_errorbar(aes(ymin=summaryD25,ymax=summaryD975), alpha=0.3, color="black", width = 0) + theme_bw() + geom_line(data = summaryD_base, aes(y = summaryDmean_base, colour = "summaryDmean_base"), size=1, color="blue") + geom_errorbar(data = summaryD_base, aes(ymin=summaryD25_base,ymax=summaryD975_base), alpha=0.3, color="blue", width = 0) + xlab("Day")
pD3 <- ggplot(summaryD, aes(day)) + geom_line(aes(y = summaryDmean, colour = "summaryDmean"), size=1, color="black") + geom_errorbar(aes(ymin=summaryD25,ymax=summaryD975), alpha=0.3, color="black", width = 0) + theme_bw() + geom_line(data = summaryD_base, aes(y = summaryDmean_base, colour = "summaryDmean_base"), size=1, color="blue") + geom_errorbar(data = summaryD_base, aes(ymin=summaryD25_base,ymax=summaryD975_base), alpha=0.3, color="blue", width = 0) + xlab("Day") + ylab("Cumulative CO2-e, CH4 (kg/ha)")
pM3 <- ggplot(summaryM, aes(day)) + geom_line(aes(y = summaryMmean, colour = "summaryMmean"), size=1, color="black") + geom_errorbar(aes(ymin=summaryM25,ymax=summaryM975), alpha=0.3, color="black", width = 0) + theme_bw() + geom_line(data = summaryM_base, aes(y = summaryMmean_base, colour = "summaryMmean_base"), size=1, color="blue") + geom_errorbar(data = summaryM_base, aes(ymin=summaryM25_base,ymax=summaryM975_base), alpha=0.3, color="blue", width = 0) + theme(axis.title.x=element_blank()) + ylab("Cumulative CO2-e, CO2 (kg/ha)")
grid.arrange(pM3, pD3, nrow = 2, ncol = 1)
ggplot(summaryM, aes(day)) + geom_line(aes(y = summaryMmean, colour = "summaryMmean"), size=1, color="black") + geom_errorbar(aes(ymin=summaryM25,ymax=summaryM975), alpha=0.3, color="black", width = 0) + theme_bw() + geom_line(data = summaryM_base, aes(y = summaryMmean_base, colour = "summaryMmean_base"), size=1, color="blue") + geom_errorbar(data = summaryM_base, aes(ymin=summaryM25_base,ymax=summaryM975_base), alpha=0.3, color="blue", width = 0) + theme(axis.title.x=element_blank()) + ylab("Cumulative CO2-e, CO2 (kg/ha)") + theme(legend.position="bottom")
ggplot(summaryM, aes(day)) + geom_line(aes(y = summaryMmean, colour = "summaryMmean"), size=1, color="black") + geom_errorbar(aes(ymin=summaryM25,ymax=summaryM975), alpha=0.3, color="black", width = 0) + theme_bw() + geom_line(data = summaryM_base, aes(y = summaryMmean_base, colour = "summaryMmean_base"), size=1, color="blue") + geom_errorbar(data = summaryM_base, aes(ymin=summaryM25_base,ymax=summaryM975_base), alpha=0.3, color="blue", width = 0) + theme(axis.title.x=element_blank()) + ylab("Cumulative CO2-e, CO2 (kg/ha)") + theme(legend.position="bottom") + scale_color_manual("",values=c("blue","black"), labels=c("Baseline", "Observed"))
ggplot(summaryM, aes(day)) + geom_line(aes(y = summaryMmean, colour = "summaryMmean"), size=1)
ggplot(summaryM, aes(day)) + geom_line(aes(y = summaryMmean, colour = "summaryMmean"), size=1) + geom_errorbar(aes(ymin=summaryM25,ymax=summaryM975), alpha=0.3, color="black", width = 0)
ggplot(summaryM, aes(day)) + geom_line(aes(y = summaryMmean, colour = "summaryMmean"), size=1) + geom_errorbar(aes(ymin=summaryM25,ymax=summaryM975), alpha=0.3, color="black", width = 0) + theme_bw() + geom_line(data = summaryM_base, aes(y = summaryMmean_base, colour = "summaryMmean_base"), size=1) + geom_errorbar(data = summaryM_base, aes(ymin=summaryM25_base,ymax=summaryM975_base), alpha=0.3, color="blue", width = 0) + theme(axis.title.x=element_blank()) + ylab("Cumulative CO2-e, CO2 (kg/ha)") + theme(legend.position="bottom")
ggplot(summaryM, aes(day)) + geom_line(aes(y = summaryMmean, colour = "summaryMmean"), size=1) + geom_errorbar(aes(ymin=summaryM25,ymax=summaryM975), alpha=0.3, color="black", width = 0) + theme_bw() + geom_line(data = summaryM_base, aes(y = summaryMmean_base, colour = "summaryMmean_base"), size=1) + geom_errorbar(data = summaryM_base, aes(ymin=summaryM25_base,ymax=summaryM975_base), alpha=0.3, color="blue", width = 0) + theme(axis.title.x=element_blank()) + ylab("Cumulative CO2-e, CO2 (kg/ha)") + theme(legend.position="bottom") + scale_color_manual("",values=c(summaryMmean="blue",summaryMmean_base="black"), labels=c("Baseline", "Observed"))
ggplot(summaryM, aes(day)) + geom_line(aes(y = summaryMmean, colour = "summaryMmean"), size=1) + geom_errorbar(aes(ymin=summaryM25,ymax=summaryM975), alpha=0.3, color="black", width = 0) + theme_bw() + geom_line(data = summaryM_base, aes(y = summaryMmean_base, colour = "summaryMmean_base"), size=1) + geom_errorbar(data = summaryM_base, aes(ymin=summaryM25_base,ymax=summaryM975_base), alpha=0.3, color="blue", width = 0) + theme(axis.title.x=element_blank()) + ylab("Cumulative CO2-e, CO2 (kg/ha)") + theme(legend.position="bottom") + scale_color_manual("",values=c(summaryMmean="blue",summaryMmean_base="black"), labels=c("Observed", "Baseline"))
ggplot(summaryM, aes(day)) + geom_line(aes(y = summaryMmean, colour = "summaryMmean"), size=1) + geom_errorbar(aes(ymin=summaryM25,ymax=summaryM975), alpha=0.3, color="black", width = 0) + theme_bw() + geom_line(data = summaryM_base, aes(y = summaryMmean_base, colour = "summaryMmean_base"), size=1) + geom_errorbar(data = summaryM_base, aes(ymin=summaryM25_base,ymax=summaryM975_base), alpha=0.3, color="blue", width = 0) + theme(axis.title.x=element_blank()) + ylab("Cumulative CO2-e, CO2 (kg/ha)") + theme(legend.position="bottom") + scale_color_manual("",values=c(summaryMmean="black",summaryMmean_base="blue"), labels=c("Observed", "Baseline"))
ggplot(summaryM, aes(day)) + geom_line(aes(y = summaryMmean, colour = "summaryMmean"), size=1) + geom_errorbar(aes(ymin=summaryM25,ymax=summaryM975), alpha=0.3, color="blue", width = 0) + theme_bw() + geom_line(data = summaryM_base, aes(y = summaryMmean_base, colour = "summaryMmean_base"), size=1) + geom_errorbar(data = summaryM_base, aes(ymin=summaryM25_base,ymax=summaryM975_base), alpha=0.3, color="black", width = 0) + theme(axis.title.x=element_blank()) + ylab("Cumulative CO2-e, CO2 (kg/ha)") + theme(legend.position="bottom") + scale_color_manual("",values=c(summaryMmean="blue",summaryMmean_base="black"), labels=c("Observed", "Baseline"))
ggplot(summaryM, aes(day)) + geom_line(aes(y = summaryMmean, colour = "summaryMmean"), size=1) + geom_errorbar(aes(ymin=summaryM25,ymax=summaryM975), alpha=0.3, color="blue", width = 0) + theme_bw() + geom_line(data = summaryM_base, aes(y = summaryMmean_base, colour = "summaryMmean_base"), size=1) + geom_errorbar(data = summaryM_base, aes(ymin=summaryM25_base,ymax=summaryM975_base), alpha=0.3, color="black", width = 0) + theme(axis.title.x=element_blank()) + ylab("Cumulative CO2-e, CO2 (kg/ha)") + theme(legend.position="none")
ggplot(summaryM, aes(day)) + geom_line(aes(y = summaryMmean, colour = "summaryMmean"), size=1) + geom_errorbar(aes(ymin=summaryM25,ymax=summaryM975), alpha=0.3, color="blue", width = 0) + theme_bw() + geom_line(data = summaryM_base, aes(y = summaryMmean_base, colour = "summaryMmean_base"), size=1) + geom_errorbar(data = summaryM_base, aes(ymin=summaryM25_base,ymax=summaryM975_base), alpha=0.3, color="black", width = 0) + theme(axis.title.x=element_blank()) + ylab("Cumulative CO2-e, CO2 (kg/ha)") + theme(legend.position="none") + scale_color_manual("",values=c(summaryMmean="blue",summaryMmean_base="black"), labels=c("Observed", "Baseline"))
ggplot(summaryM, aes(day)) + geom_line(aes(y = summaryMmean, colour = "summaryMmean"), size=1) + geom_errorbar(aes(ymin=summaryM25,ymax=summaryM975), alpha=0.3, color="blue", width = 0) + theme_bw() + geom_line(data = summaryM_base, aes(y = summaryMmean_base, colour = "summaryMmean_base"), size=1) + geom_errorbar(data = summaryM_base, aes(ymin=summaryM25_base,ymax=summaryM975_base), alpha=0.3, color="black", width = 0) + theme(axis.title.x=element_blank()) + ylab("Cumulative CO2-e, CO2 (kg/ha)") + theme(legend.position="right") + scale_color_manual("",values=c(summaryMmean="blue",summaryMmean_base="black"), labels=c("Observed", "Baseline"))
ggplot(summaryM, aes(day)) + geom_line(aes(y = summaryMmean, colour = "summaryMmean"), size=1) + geom_errorbar(aes(ymin=summaryM25,ymax=summaryM975), alpha=0.3, color="blue", width = 0) + theme_bw() + geom_line(data = summaryM_base, aes(y = summaryMmean_base, colour = "summaryMmean_base"), size=1) + geom_errorbar(data = summaryM_base, aes(ymin=summaryM25_base,ymax=summaryM975_base), alpha=0.3, color="black", width = 0) + theme(axis.title.x=element_blank()) + ylab("Cumulative CO2-e, CO2 (kg/ha)") + theme(legend.position="bottom") + scale_color_manual("",values=c(summaryMmean="blue",summaryMmean_base="black"), labels=c("Observed", "Baseline"))
ggplot(summaryD, aes(day)) + geom_line(aes(y = summaryDmean, colour = "summaryDmean"), size=1) + geom_errorbar(aes(ymin=summaryD25,ymax=summaryD975), alpha=0.3, color="black", width = 0) + theme_bw() + geom_line(data = summaryD_base, aes(y = summaryDmean_base, colour = "summaryDmean_base"), size=1) + geom_errorbar(data = summaryD_base, aes(ymin=summaryD25_base,ymax=summaryD975_base), alpha=0.3, color="blue", width = 0) + xlab("Day") + ylab("Cumulative CO2-e, CH4 (kg/ha)") + theme(legend.position="bottom") + scale_color_manual("",values=c(summaryMmean="blue",summaryMmean_base="black"), labels=c("Observed", "Baseline"))
ggplot(summaryD, aes(day)) + geom_line(aes(y = summaryDmean, colour = "summaryDmean"), size=1)
ggplot(summaryD, aes(day)) + geom_line(aes(y = summaryDmean, colour = "summaryDmean"), size=1) + geom_errorbar(aes(ymin=summaryD25,ymax=summaryD975), alpha=0.3, color="black", width = 0)
ggplot(summaryD, aes(day)) + geom_line(aes(y = summaryDmean, colour = "summaryDmean"), size=1) + geom_errorbar(aes(ymin=summaryD25,ymax=summaryD975), alpha=0.3, color="black", width = 0) + theme_bw()
ggplot(summaryD, aes(day)) + geom_line(aes(y = summaryDmean, colour = "summaryDmean"), size=1) + geom_errorbar(aes(ymin=summaryD25,ymax=summaryD975), alpha=0.3, color="black", width = 0) + theme_bw() + geom_line(data = summaryD_base, aes(y = summaryDmean_base, colour = "summaryDmean_base"), size=1)
ggplot(summaryD, aes(day)) + geom_line(aes(y = summaryDmean, colour = "summaryDmean"), size=1) + geom_errorbar(aes(ymin=summaryD25,ymax=summaryD975), alpha=0.3, color="black", width = 0) + theme_bw() + geom_line(data = summaryD_base, aes(y = summaryDmean_base, colour = "summaryDmean_base"), size=1) + geom_errorbar(data = summaryD_base, aes(ymin=summaryD25_base,ymax=summaryD975_base), alpha=0.3, color="blue", width = 0)
ggplot(summaryD, aes(day)) + geom_line(aes(y = summaryDmean, colour = "summaryDmean"), size=1) + geom_errorbar(aes(ymin=summaryD25,ymax=summaryD975), alpha=0.3, color="black", width = 0) + theme_bw() + geom_line(data = summaryD_base, aes(y = summaryDmean_base, colour = "summaryDmean_base"), size=1) + geom_errorbar(data = summaryD_base, aes(ymin=summaryD25_base,ymax=summaryD975_base), alpha=0.3, color="blue", width = 0) + xlab("Day") + ylab("Cumulative CO2-e, CH4 (kg/ha)")
ggplot(summaryD, aes(day)) + geom_line(aes(y = summaryDmean, colour = "summaryDmean"), size=1) + geom_errorbar(aes(ymin=summaryD25,ymax=summaryD975), alpha=0.3, color="black", width = 0) + theme_bw() + geom_line(data = summaryD_base, aes(y = summaryDmean_base, colour = "summaryDmean_base"), size=1) + geom_errorbar(data = summaryD_base, aes(ymin=summaryD25_base,ymax=summaryD975_base), alpha=0.3, color="blue", width = 0) + xlab("Day") + ylab("Cumulative CO2-e, CH4 (kg/ha)") + theme(legend.position="bottom")
ggplot(summaryD, aes(day)) + geom_line(aes(y = summaryDmean, colour = "summaryDmean"), size=1) + geom_errorbar(aes(ymin=summaryD25,ymax=summaryD975), alpha=0.3, color="black", width = 0) + theme_bw() + geom_line(data = summaryD_base, aes(y = summaryDmean_base, colour = "summaryDmean_base"), size=1) + geom_errorbar(data = summaryD_base, aes(ymin=summaryD25_base,ymax=summaryD975_base), alpha=0.3, color="blue", width = 0) + xlab("Day") + ylab("Cumulative CO2-e, CH4 (kg/ha)") + theme(legend.position="bottom") + scale_color_manual("",values=c(summaryDmean="blue",summaryDmean_base="black"), labels=c("Observed", "Baseline"))
ggplot(summaryD, aes(day)) + geom_line(aes(y = summaryDmean, colour = "summaryDmean"), size=1) + geom_errorbar(aes(ymin=summaryD25,ymax=summaryD975), alpha=0.3, color="blue", width = 0) + theme_bw() + geom_line(data = summaryD_base, aes(y = summaryDmean_base, colour = "summaryDmean_base"), size=1) + geom_errorbar(data = summaryD_base, aes(ymin=summaryD25_base,ymax=summaryD975_base), alpha=0.3, color="black", width = 0) + xlab("Day") + ylab("Cumulative CO2-e, CH4 (kg/ha)") + theme(legend.position="bottom") + scale_color_manual("",values=c(summaryDmean="blue",summaryDmean_base="black"), labels=c("Observed", "Baseline"))
pD3 <- ggplot(summaryD, aes(day)) + geom_line(aes(y = summaryDmean, colour = "summaryDmean"), size=1) + geom_errorbar(aes(ymin=summaryD25,ymax=summaryD975), alpha=0.3, color="blue", width = 0) + theme_bw() + geom_line(data = summaryD_base, aes(y = summaryDmean_base, colour = "summaryDmean_base"), size=1) + geom_errorbar(data = summaryD_base, aes(ymin=summaryD25_base,ymax=summaryD975_base), alpha=0.3, color="black", width = 0) + xlab("Day") + ylab("Cumulative CO2-e, CH4 (kg/ha)") + theme(legend.position="bottom") + scale_color_manual("",values=c(summaryDmean="blue",summaryDmean_base="black"), labels=c("Observed", "Baseline"))
pM3 <- ggplot(summaryM, aes(day)) + geom_line(aes(y = summaryMmean, colour = "summaryMmean"), size=1) + geom_errorbar(aes(ymin=summaryM25,ymax=summaryM975), alpha=0.3, color="blue", width = 0) + theme_bw() + geom_line(data = summaryM_base, aes(y = summaryMmean_base, colour = "summaryMmean_base"), size=1) + geom_errorbar(data = summaryM_base, aes(ymin=summaryM25_base,ymax=summaryM975_base), alpha=0.3, color="black", width = 0) + theme(axis.title.x=element_blank()) + ylab("Cumulative CO2-e, CO2 (kg/ha)") + theme(legend.position="none") + scale_color_manual("",values=c(summaryMmean="blue",summaryMmean_base="black"), labels=c("Observed", "Baseline"))
# save combined panels
png(file = paste(pathsavefigs, "CO2e_cumulative.png", sep=""),width=5,height=6,units="in",res=400)
grid.arrange(pM3, pD3, nrow = 2, ncol = 1)
dev.off()
pD3 <- ggplot(summaryD, aes(day)) + geom_line(aes(y = summaryDmean, colour = "summaryDmean"), size=1) + geom_errorbar(aes(ymin=summaryD25,ymax=summaryD975), alpha=0.3, color="blue", width = 0) + theme_bw() + geom_line(data = summaryD_base, aes(y = summaryDmean_base, colour = "summaryDmean_base"), size=1) + geom_errorbar(data = summaryD_base, aes(ymin=summaryD25_base,ymax=summaryD975_base), alpha=0.3, color="black", width = 0) + xlab("Day") + ylab("Cumulative CO2-e, CH4 (kg/ha)") + theme(legend.position="none") + scale_color_manual("",values=c(summaryDmean="blue",summaryDmean_base="black"), labels=c("Observed", "Baseline"))
pM3 <- ggplot(summaryM, aes(day)) + geom_line(aes(y = summaryMmean, colour = "summaryMmean"), size=1) + geom_errorbar(aes(ymin=summaryM25,ymax=summaryM975), alpha=0.3, color="blue", width = 0) + theme_bw() + geom_line(data = summaryM_base, aes(y = summaryMmean_base, colour = "summaryMmean_base"), size=1) + geom_errorbar(data = summaryM_base, aes(ymin=summaryM25_base,ymax=summaryM975_base), alpha=0.3, color="black", width = 0) + theme(axis.title.x=element_blank()) + ylab("Cumulative CO2-e, CO2 (kg/ha)") + theme(legend.position="none") + scale_color_manual("",values=c(summaryMmean="blue",summaryMmean_base="black"), labels=c("Observed", "Baseline"))
# save combined panels
png(file = paste(pathsavefigs, "CO2e_cumulative.png", sep=""),width=5,height=6,units="in",res=400)
grid.arrange(pM3, pD3, nrow = 2, ncol = 1)
dev.off()
pD3 + theme(legend.position="bottom")
png(file = paste(pathsavefigs, "CO2e_CH4_getlegend.png", sep=""),width=5,height=6,units="in",res=400)
pD3 + theme(legend.position="bottom")
dev.off()
png(file = paste(pathsavefigs, "CO2e_cumulative.png", sep=""),width=5,height=8,units="in",res=400)
png(file = paste(pathsavefigs, "CO2e_cumulative.png", sep=""),width=5,height=8,units="in",res=400)
grid.arrange(pM3, pD3, nrow = 2, ncol = 1)
dev.off()
simulationreps <- 10000
# applies to both CO2 and CH4
lengthperiod <- c(61,121,92,52)
simulationreps <- 10000
# topolocation proportion
ridgeprop	<- 0.17
slopeprop <-	0.65
valleyprop <-	0.18
########################################################################
# CO2-e CO2 SIMULATION
## CO2e CO2 calcs
# meanCO2_umolm2s
CO2meanR <- c(1.829500922,1.508863804,1.88162955,2.772106974)
CO2meanS <- c(3.793756534,6.058448581,5.13065924,4.515184411)
CO2meanV <- c(0.572222123,1.506285204,1.360654498,2.946791535)
# sdCO2_umolm2s
CO2sdR <- c(1.467956332,1.046804732,1.636949891,2.420277315)
CO2sdS <- c(2.921048514,4.255562169,4.339260199,2.797889389)
CO2sdV <- c(0.172000807,0.752823235,0.473832261,1.025457778)
# topo wgt avg, CO2_umolm2s
CO2meanRSV <- (CO2meanR*ridgeprop)+(CO2meanS*slopeprop)+(CO2meanV*valleyprop)
CO2sdRSV <- (CO2sdR*ridgeprop)+(CO2sdS*slopeprop)+(CO2sdV*valleyprop)
# CO2_kg_per_ha_per_d
CO2e_CO2_daymeanRSV <- CO2meanRSV * 12.01 * 10000 * 86400 / 1000000000
CO2e_CO2_daysdRSV <- CO2sdRSV * 12.01 * 10000 * 86400 / 1000000000
# create a matrix of many cumulative sum steps
# observed drought periods
M1 <- replicate(simulationreps, rtruncnorm(n=lengthperiod[1], a=0, b=Inf, mean=CO2e_CO2_daymeanRSV[1], sd=CO2e_CO2_daysdRSV[1]))
# figure-fluxes-CO2equivalent.R
#
# make the nicer version of the CO2 equivalent time series graph
#
# O2 - redox - GHG project
# CS O'Connell, UCB, Silver Lab
# note that Christine put together this dataset by hand in excel
# see ghg-co2e-analysis.xlsx
# output products:
# figures in folder /DroughtMSFigures/
# tables in folder /DroughtMSTables/
########################################################################
# GET READY TO BRING IN DATA
library(ggplot2)
library(gridExtra)
library(scales)
library(dplyr)
library(nlme)      ## for lme()
library(multcomp)  ## for multiple comparison stuff
#library(data.table)
#library(chron)
library(lubridate)
#library(lattice)
library(reshape2)
#options(java.parameters = "-Xmx5000m") # make sure there's sufficient memory to open excel file
library(xlsx)
library(strucchange) # piecewise regression
library(truncnorm)
# summarySE using plyr
source("~/Documents/GITHUB/RPersonalFunctionsChristine/summarySE.r")
# where to save outputs
pathsavefiles = "~/Documents/GITHUB/cso040code_ArrayGHG/ArrayGHG-Data-Rprocessed/"
pathsavefigs = "~/Documents/GITHUB/cso040code_ArrayGHG/ArrayGHG-Data-Analyses/DroughtMSFigures/"
pathGHGdata = "~/Documents/GITHUB/cso040code_ArrayGHG/ArrayGHG-Data-Analyses/GHG-CO2e-analysis/"
pathsavetab = "~/Documents/GITHUB/cso040code_ArrayGHG/ArrayGHG-Data-Analyses/DroughtMSTables/"
M1 <- replicate(simulationreps, rtruncnorm(n=lengthperiod[1], a=0, b=Inf, mean=CO2e_CO2_daymeanRSV[1], sd=CO2e_CO2_daysdRSV[1]))
5+7
x <- 5+7
zen()
x <- 5+7
z <-5
w<-7
y <- z + w
temp <- "hello"
str(temp)
?str
# figure-fluxes-ghgarraydrought.R
#
# process the GHG flux data from the eosAnalyze program
# make GHG flux figures
# do statistical work on fluxes
# there's no moisture/O2/precip stuff in this script
#
# O2 - redox - GHG project
# CS O'Connell, UCB, Silver Lab
# see also (update before making this figure if needed!):
# Process-arraysensorsdf-Sensor-Excel-Data-Rcode.R is where arraysensorsdf.csv gets built
# figure-precipO2moisture-ghgarraydrought.R - where the moisture/O2/precip stuff is
# output products:
# figures in folder /DroughtMSFigures/
# tables in folder /DroughtMSTables/
########################################################################
# GET READY TO BRING IN DATA
library(ggplot2)
library(gridExtra)
library(scales)
library(dplyr)
library(nlme)      ## for lme()
library(multcomp)  ## for multiple comparison stuff
#library(data.table)
#library(chron)
library(lubridate)
#library(lattice)
#library(reshape2)
#options(java.parameters = "-Xmx5000m") # make sure there's sufficient memory to open excel file
library(xlsx)
library(strucchange) # piecewise regression
# summarySE using plyr
source("~/Documents/GITHUB/RPersonalFunctionsChristine/summarySE.r")
# where to save outputs
pathsavefiles = "~/Documents/GITHUB/cso040code_ArrayGHG/ArrayGHG-Data-Rprocessed/"
pathsavefigs = "~/Documents/GITHUB/cso040code_ArrayGHG/ArrayGHG-Data-Analyses/DroughtMSFigures/"
pathGHGdata = "~/Documents/GITHUB/NOT REPOS/cso040code_ArrayGHG_LargeFiles/Chamber-data-large-files/eosAnalyzeACProcessed/"
pathrainfalldata = "~/Documents/GITHUB/cso040code_ArrayGHG/ArrayGHG-Data-Raw/Rainfall-data-Ryan/"
pathsavetab = "~/Documents/GITHUB/cso040code_ArrayGHG/ArrayGHG-Data-Analyses/DroughtMSTables/"
pathsoildata = "~/Documents/GITHUB/cso040code_ArrayGHG/ArrayGHG-Data-Raw/Soil-data/"
########################################################################
# BRING IN GHG DATA, MAKE DATAFRAME
# load csv
arrayGHGdf <- read.csv(paste(pathGHGdata, "ArrayGHG_master_chamber_data-deadbandcombined.csv", sep = ""), stringsAsFactors=FALSE)
View(arrayGHGdf)
str(arrayGHGdf)
temp <- "hello"
View(arrayGHGdf)
View(arrayGHGdf)
View(arrayGHGdf)
newnames <- c("DateTime","Chamber","MeasurementDuration_s","MeanCO2_ppm","MeanCH4_ppm","MeanN2O_ppm","MeanNH3_ppm","MeanH2O_percent","ChemDetect_0-1","CavPressure_kPa","CavTemperature_K","WaterContent_fraction","ChamberTemperature_K","ChamberPressure_kPa","FluxCO2_L_umolm2s","FluxCO2_E_umolm2s","FluxCH4_L_nmolm2s","FluxCH4_E_nmolm2s","FluxN2O_L_nmolm2s","FluxN2O_E_nmolm2s","FluxNH3_L_umolm2s","FluxNH3_E_umolm2s","e_FluxCO2_L_umolm2s","e_FluxCO2_E_umolm2s","e_FluxCH4_L_nmolm2s","e_FluxCH4_E_nmolm2s","e_FluxN2O_L_nmolm2s","e_FluxN2O_E_nmolm2s","e_FluxNH3_L_umolm2s","e_FluxNH3_E_umolm2s","AUXVoltage1_V","AUXVoltage2_V","AUXVoltage3_V","AUXCurrent1_mA","AUXCurrent2_mA","Metadata","Deadband","System","DataSource")
names(arrayGHGdf) <- newnames
# make dates nice
arrayGHGdf$DateTime2 <- mdy_hm(arrayGHGdf$DateTime)
# rip out date only
arrayGHGdf$Date <- substr(arrayGHGdf$DateTime2,1,11)
arrayGHGdf$Date <- ymd(arrayGHGdf$Date)
View(arrayGHGdf)
arrayGHGdf$Chamber
View(arrayGHGdf)
arrayGHGdf$Chamber*3
View(arrayGHGdf)
arrayGHGdf$Chamber2 <- arrayGHGdf$Chamber*3
View(arrayGHGdf)
clc()
?mean
swirl()
library(swirl)
swirl()
# figure-fluxes-CO2equivalent.R
#
# make the nicer version of the CO2 equivalent time series graph
#
# O2 - redox - GHG project
# CS O'Connell, UCB, Silver Lab
# note that Christine put together this dataset by hand in excel
# see ghg-co2e-analysis.xlsx
# output products:
# figures in folder /DroughtMSFigures/
# tables in folder /DroughtMSTables/
########################################################################
# GET READY TO BRING IN DATA
library(ggplot2)
library(gridExtra)
library(scales)
library(dplyr)
library(nlme)      ## for lme()
library(multcomp)  ## for multiple comparison stuff
#library(data.table)
#library(chron)
library(lubridate)
#library(lattice)
library(reshape2)
#options(java.parameters = "-Xmx5000m") # make sure there's sufficient memory to open excel file
library(xlsx)
library(strucchange) # piecewise regression
library(truncnorm)
# summarySE using plyr
source("~/Documents/GITHUB/RPersonalFunctionsChristine/summarySE.r")
# where to save outputs
pathsavefiles = "~/Documents/GITHUB/cso040code_ArrayGHG/ArrayGHG-Data-Rprocessed/"
pathsavefigs = "~/Documents/GITHUB/cso040code_ArrayGHG/ArrayGHG-Data-Analyses/DroughtMSFigures/"
pathGHGdata = "~/Documents/GITHUB/cso040code_ArrayGHG/ArrayGHG-Data-Analyses/GHG-CO2e-analysis/"
pathsavetab = "~/Documents/GITHUB/cso040code_ArrayGHG/ArrayGHG-Data-Analyses/DroughtMSTables/"
########################################################################
# GET READY TO BRING IN DATA
library(ggplot2)
library(gridExtra)
library(scales)
library(dplyr)
library(nlme)      ## for lme()
library(multcomp)  ## for multiple comparison stuff
#library(data.table)
#library(chron)
library(lubridate)
#library(lattice)
#library(reshape2)
#options(java.parameters = "-Xmx5000m") # make sure there's sufficient memory to open excel file
library(xlsx)
# summarySE using plyr
source("~/Documents/GITHUB/RPersonalFunctionsChristine/summarySE.r")
# gen_data_aov_onlymeansdN
source("~/Documents/GITHUB/RPersonalFunctionsChristine/gen_data_aov_onlymeansdN.r")
# where to save outputs
pathsavefiles = "~/Documents/GITHUB/cso040code_ArrayGHG/ArrayGHG-Data-Rprocessed/"
pathsavefigs = "~/Documents/GITHUB/cso040code_ArrayGHG/ArrayGHG-Data-Analyses/DroughtMSFigures/"
pathsavetab = "~/Documents/GITHUB/cso040code_ArrayGHG/ArrayGHG-Data-Analyses/DroughtMSTables/"
pathsoildata = "~/Documents/GITHUB/cso040code_ArrayGHG/ArrayGHG-Data-Raw/Soil-data/"
########################################################################
# ORGANIZE SOIL VARIABLES
# load csv
soilvardf <- read.csv(paste(pathsoildata, "PR_ElVerdeArray_SoilData_Master_Combo_csv.csv", sep = ""), stringsAsFactors=FALSE)
# nice names
newnames <- c("Sample","Location","Replicate","Depth","DroughtTimePds","SamplingMonth","TinWgt_g","TinWetSoil_g","TinDrySoil_g","SoilMeasured_FeinHCl_g","SoilMeasured_PinNaHCO3_g","SoilMeasured_pH_g","pH_timeH2Oin","pH_timeread","pH","ReagentMeasured_NaOH","ReagentMeasured_NaHCO3","ReagentMeasured_HCl","ReagentMeasured_KClday0","ReagentMeasured_KClday7","SoilMeasured_NinKClconcentrationsday0_g","SoilMeasured_NinKCltransformationsday0_g","SoilMeasured_NinKCltransformationsday7_g","FeIIconcentration_mgFeg","FeII_IIIconcentration_mgFeg","FeIIIconcentration_mgFeg","P_i_bicarb","P_t_bicarb","P_o_bicarb","P_i_NaOH","P_t_NaOH","P_o_NaOH","P_total")
names(soilvardf) <- newnames
# make factors where needed
soilvardf$Location <- as.factor(soilvardf$Location)
soilvardf$Depth <- as.factor(soilvardf$Depth)
soilvardf$DroughtTimePds <- as.factor(soilvardf$DroughtTimePds)
# reorder time period factor to make temporally appropriate
print(levels(soilvardf$DroughtTimePds))
soilvardf$DroughtTimePds <- factor(soilvardf$DroughtTimePds,levels(soilvardf$DroughtTimePds)[c(4,2,3,1)])
print(levels(soilvardf$DroughtTimePds))
# make numeric where needed
soilvardf$FeIIconcentration_mgFeg <- as.numeric(soilvardf$FeIIconcentration_mgFeg)
soilvardf$FeII_IIIconcentration_mgFeg <- as.numeric(soilvardf$FeII_IIIconcentration_mgFeg)
# str(soilvardf)
# make variable where mid and low slope are combined
soilvardf$Topo <- NA
soilvardf$Topo[soilvardf$Location=="Ridge"] <- "Ridge"
soilvardf$Topo[soilvardf$Location=="Valley"] <- "Valley"
soilvardf$Topo[soilvardf$Location=="Slope" | soilvardf$Location=="Low-slope" | soilvardf$Location=="Mid-slope"] <- "Slope"
# get rid of places where Fe(III) is negative
soilvardf$FeIIIconcentration_mgFeg[soilvardf$FeIIIconcentration_mgFeg < 0] <- NA
soilvardf$FeIIconcentration_mgFeg[soilvardf$FeIIIconcentration_mgFeg < 0] <- NA
soilvardf$FeII_IIIconcentration_mgFeg[soilvardf$FeIIIconcentration_mgFeg < 0] <- NA
source("~/Documents/GITHUB/RPersonalFunctionsChristine/summarySE.r")
# summarySE sets - by drought period and topographic location for each variable of interest
# pH
summarytabSoilVarspH <- summarySE(data=soilvardf, measurevar="pH", c("DroughtTimePds", "Topo","Depth"), na.rm=TRUE, renameallcols=TRUE)
# get rid of weird categories
summarytabSoilVarspH <- subset(summarytabSoilVarspH, summarytabSoilVarspH$N>0)
summarytabSoilVarspH
# pH
summarytabSoilVarspH <- summarySE(data=soilvardf, measurevar="pH", c("DroughtTimePds", "Topo","Depth"), na.rm=TRUE, renameallcols=TRUE)
# get rid of weird categories
summarytabSoilVarspH <- subset(summarytabSoilVarspH, summarytabSoilVarspH$N>0)
# Fe(II)
summarytabSoilVarsFeII <- summarySE(data=soilvardf, measurevar="FeIIconcentration_mgFeg", c("DroughtTimePds", "Topo","Depth"), na.rm=TRUE, renameallcols=TRUE)
# get rid of weird categories
summarytabSoilVarsFeII <- subset(summarytabSoilVarsFeII, summarytabSoilVarsFeII$N>0)
# Fe(III)
#soilvardf$FeIIIminusFeII <- soilvardf$FeII_IIIconcentration_mgFeg - soilvardf$FeIIconcentration_mgFeg
summarytabSoilVarsFeIII <- summarySE(data=soilvardf, measurevar="FeIIIconcentration_mgFeg", c("DroughtTimePds", "Topo","Depth"), na.rm=TRUE, renameallcols=TRUE)
# get rid of weird categories
summarytabSoilVarsFeIII <- subset(summarytabSoilVarsFeIII, summarytabSoilVarsFeIII$N>0)
# Pi
soilvardf$PiCombo <- soilvardf$P_i_bicarb + soilvardf$P_i_NaOH
summarytabSoilVarsPiCombo <- summarySE(data=soilvardf, measurevar="PiCombo", c("DroughtTimePds", "Topo","Depth"), na.rm=TRUE, renameallcols=TRUE)
# get rid of weird categories
summarytabSoilVarsPiCombo <- subset(summarytabSoilVarsPiCombo, summarytabSoilVarsPiCombo$N>0)
# Po
soilvardf$PoCombo <- soilvardf$P_o_bicarb + soilvardf$P_o_NaOH
summarytabSoilVarsPoCombo <- summarySE(data=soilvardf, measurevar="PoCombo", c("DroughtTimePds", "Topo","Depth"), na.rm=TRUE, renameallcols=TRUE)
# get rid of weird categories
summarytabSoilVarsPoCombo <- subset(summarytabSoilVarsPoCombo, summarytabSoilVarsPoCombo$N>0)
summarytabSoilVarsPoCombo
pathsavetab
summarytabSoilVarspH
write.xlsx(summarytabSoilVarspH, file=paste(path.expand(pathsavetab), "drought_periods_summarytable_topo_pH.xlsx",sep=""), sheetName="summary pH")
?save.csv
?write.csv
fname = paste(pathsavetab, "drought_periods_summarytable_topo_pH.csv" ,sep="")
write.csv(summarytabSoilVarspH, file = fname, na = "")
fname = paste(pathsavetab, "drought_periods_summarytable_topo_pH.csv" ,sep="")
write.csv(summarytabSoilVarspH, file = fname, na = "")
fname = paste(pathsavetab, "drought_periods_summarytable_topo_FeII.csv" ,sep="")
write.csv(summarytabSoilVarsFeII, file = fname, na = "")
fname = paste(pathsavetab, "drought_periods_summarytable_topo_FeIII.csv" ,sep="")
write.csv(summarytabSoilVarsFeIII, file = fname, na = "")
fname = paste(pathsavetab, "drought_periods_summarytable_topo_Pi.csv" ,sep="")
write.csv(summarytabSoilVarsPiCombo, file = fname, na = "")
fname = paste(pathsavetab, "drought_periods_summarytable_topo_Po.csv" ,sep="")
write.csv(summarytabSoilVarsPoCombo, file = fname, na = "")
